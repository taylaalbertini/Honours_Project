library(gprofiler2)
library(forcats)
library(rrvgo)
library(ComplexHeatmap)
# set project directory
projectDir <- "/Users/taylaalbertini/Desktop/R studio/honours_project/term_sex_specific_analysis/rawData"
import_placentaF_depleted <- file.path(projectDir, "termF_placenta_depleted_annotated.csv")
import_placnetaM_depleted <- file.path(projectDir, "termM_placenta_depleted_annotated.csv")
# Chunk 2
# import placenta female depleted table and make it into a data frame
placentaF_depleted <- read_delim(import_placentaF_depleted,
col_names = TRUE,
delim = ",") %>%
as.data.frame() %>%
## tidy placentaF_depleted - remove the "...1" column
dplyr::select(., -...1)
# import male placenta depleted table and make into a data frame
placentaM_depleted <- read_delim(import_placnetaM_depleted,
col_names = TRUE,
delim = ",") %>%
as.data.frame() %>%
## tidy placentaM_depleted - remove the "...1" column
dplyr::select(., -...1)
# Chunk 3
# female placenta enrichment analysis
## order genes by nCPM_ratio
placentaF_ordered <- placentaF_depleted[order(placentaF_depleted$nCPM_ratio_TMM, decreasing = TRUE),]
# perform enrichment analysis on ordered genes
placentaF_ordered_enriched <- gost(placentaF_ordered$ensembl, organism = "hsapiens",
ordered_query = TRUE)
head(placentaF_ordered_enriched$result, 7)
# male placenta enrichment analysis
# order genes by nCPM_ratio
placentaM_ordered <- placentaM_depleted[order(placentaM_depleted$nCPM_ratio_TMM, decreasing = TRUE),]
# perform enrichment on ordered genes
placentaM_ordered_enriched <- gost(placentaM_ordered$ensembl, organism = "hsapiens",
ordered_query = TRUE)
head(placentaM_ordered_enriched$result, 50)
# BP
## create similarity matrix for GO terms of BP source
simMatrixM_BP <- calculateSimMatrix(placentaM_ordered_enriched$result$term_id,
orgdb = "org.Hs.eg.db",
ont = "BP",
method = "Rel")
## set scores
scoresM <- setNames(-log10(placentaM_ordered_enriched$result$p_value), placentaM_ordered_enriched$result$term_id)
## reduce the number of terms based on the similarity matrix for BP terms
reducedTermsM_BP <- reduceSimMatrix(simMatrixM_BP,
threshold = 0.85,
orgdb = "org.Hs.eg.db",
scoresM)
## add the source to table
reducedTermsM_BP$source <- "BP"
# CC
## create similarity matrix for GO terms of CC source
simMatrixM_CC <- calculateSimMatrix(placentaM_ordered_enriched$result$term_id,
orgdb = "org.Hs.eg.db",
ont = "CC",
method = "Rel")
## reduce the number of terms based on the similarity matrix for CC terms
reducedTermsM_CC <- reduceSimMatrix(simMatrixM_CC,
threshold = 0.85,
orgdb = "org.Hs.eg.db",
scoresM)
## add the source to table
reducedTermsM_CC$source <- "CC"
# create a table of reduced terms
reducedM_BP <- dplyr::select(reducedTermsM_BP, parent, parentTerm, size, source)
reducedM_CC <- dplyr::select(reducedTermsM_CC, parent, parentTerm, size, source)
reducedTerms_termM <- rbind(reducedM_BP, reducedM_CC) %>%
group_by(parentTerm, source) %>%
summarise(size = sum(size), .groups = 'drop')
# male plot
reducedTerms_termM %>%
mutate(parentTerm = fct_reorder(parentTerm, desc(size))) %>%
ggplot( aes(x=parentTerm, y=size, fill = source)) +
geom_bar(stat="identity", alpha=.8, width=.7) +
coord_flip() +
labs(x = "GO Term", y = "Number of Associations", fill = "Source") +
theme_bw() +
theme(text = element_text(size = 10)) +
scale_y_continuous(expand = c(0, 300)) +
scale_fill_manual(values = c("#9ECAE1", "#E41A1C", "#B8E186"))
# male plot
reducedTerms_termM %>%
mutate(parentTerm = fct_reorder(parentTerm, desc(size))) %>%
ggplot( aes(x=parentTerm, y=size, fill = source)) +
geom_bar(stat="identity", alpha=.8, width=.7) +
coord_flip() +
labs(x = "GO Term", y = "Number of Associations", fill = "Source") +
theme_bw() +
theme(text = element_text(size = 12)) +
scale_y_continuous(expand = c(0, 300)) +
scale_fill_manual(values = c("#9ECAE1", "#E41A1C", "#B8E186"))
ggsave("termM_fetalSex_go_bar.png", width = 7, height = 7, units = "in")
# Chunk 1
# load relevant libraries
library(plyr)
library(reshape2)
library(dplyr)
library(stringr)
library(readxl)
library(readr)
library(magrittr)
library(ggplot2)
library(edgeR)
library(limma)
library(Glimma)
library(RColorBrewer)
# set project directory
projectDir <- "/Users/taylaalbertini/Desktop/R studio/honours_project/sexSpecific_comparison/rawData"
# set path for data tables
import_depletedM <- file.path(projectDir, "depleted_M.csv")
import_meanM_ncpms <- file.path(projectDir, "mean_placenta_cpms_TMM.csv")
# Chunk 2
# import male placenta depleted transcript table
placentaM_depleted <- read_delim(file = import_depletedM,
col_names = TRUE,
delim = ",") %>%
as.data.frame() %>%
## remove the first column "...1" that;s input when the file is imported
dplyr::select(., -...1)
# import ncpms of all male tissues
ncpms_male <- read_delim(file = import_meanM_ncpms,
col_names = TRUE,
delim = ",") %>%
as.data.frame() %>%
## remove the first column "...1" that;s input when the file is imported
dplyr::select(., -...1)
# transform ncpm table so that 'ensembl' are rownames and sex_tissue are columns with ncpms
ncpms_male_2 <- t(ncpms_male) %>%
data.frame() %>%
tibble::rownames_to_column("ensembl")
# tidy table
## remove placenta counts
ncpms_male_2 <- ncpms_male_2[,-3]
## rename column names
colnames(ncpms_male_2) <- gsub("X1", "Female Placenta (mid-gestation)", colnames(ncpms_male_2))
## remove sex_tissue row
ncpms_male_2 <- ncpms_male_2[-1,]
# subset placentaF_depleted to only include ncpms_TMM for placenta and corresponding ensembl IDs
depleted_placentaM <- dplyr::select(placentaM_depleted, ensembl, nCPM_male_placenta_TMM)
# left join ncpms_male_2 to depleted_placentaF
heat_plot <- dplyr::left_join(depleted_placentaM, ncpms_male_2, by = join_by(ensembl))
# tidy
## replace placenta colname
colnames(heat_plot) <- gsub("nCPM_male_placenta_TMM", "Male Placenta (mid-gestation)", colnames(heat_plot))
## put ncpms in descending order
heat_plot_ordered <- heat_plot[order(heat_plot$`Male Placenta`, decreasing = TRUE),]
## make heat_plot_ordered numeric
heat_plot_ordered$`Female Placenta` <- as.numeric(heat_plot_ordered$`Female Placenta`)
## change order so that placenta is last
heat_plot_ordered <- dplyr::relocate(heat_plot_ordered, `Male Placenta (mid-gestation)`, .after = `Female Placenta (mid-gestation)`)
rownames(heat_plot_ordered) <- NULL
pheat_plot <- tibble::column_to_rownames(heat_plot_ordered, var = "ensembl")
# complex heatmap
library(ComplexHeatmap)
# Heatmap function to visualise the matrix as a heatmap with default settings
## make my df a matrix
class(pheat_plot)
mat <- as.matrix(pheat_plot)
## column splot
column_split_vector <- c(rep("Group 1", 1), "Group 2")
## craete box plot annotation
column_ha <- HeatmapAnnotation(`log10 (nCPMs)` = anno_boxplot(log10(mat), which = c("column"), height = unit(4, "cm")))
View(mat)
## make heat_plot_ordered numeric
heat_plot_ordered$`Female Placenta` <- as.numeric(heat_plot_ordered$`Female Placenta (mid-gestation)`)
## change order so that placenta is last
heat_plot_ordered <- dplyr::relocate(heat_plot_ordered, `Male Placenta (mid-gestation)`, .after = `Female Placenta (mid-gestation)`)
rownames(heat_plot_ordered) <- NULL
pheat_plot <- tibble::column_to_rownames(heat_plot_ordered, var = "ensembl")
# complex heatmap
library(ComplexHeatmap)
# Heatmap function to visualise the matrix as a heatmap with default settings
## make my df a matrix
class(pheat_plot)
mat <- as.matrix(pheat_plot)
## column splot
column_split_vector <- c(rep("Group 1", 1), "Group 2")
## craete box plot annotation
column_ha <- HeatmapAnnotation(`log10 (nCPMs)` = anno_boxplot(log10(mat), which = c("column"), height = unit(4, "cm")))
## put ncpms in descending order
heat_plot_ordered <- heat_plot[order(heat_plot$`Male Placenta (mid-gestation)`, decreasing = TRUE),]
str(pheat_plot)
# Chunk 1
# load relevant libraries
library(plyr)
library(reshape2)
library(dplyr)
library(stringr)
library(readxl)
library(readr)
library(magrittr)
library(ggplot2)
library(edgeR)
library(limma)
library(Glimma)
library(RColorBrewer)
# set project directory
projectDir <- "/Users/taylaalbertini/Desktop/R studio/honours_project/sexSpecific_comparison/rawData"
# set path for data tables
import_depletedM <- file.path(projectDir, "depleted_M.csv")
import_meanM_ncpms <- file.path(projectDir, "mean_placenta_cpms_TMM.csv")
# Chunk 2
# import male placenta depleted transcript table
placentaM_depleted <- read_delim(file = import_depletedM,
col_names = TRUE,
delim = ",") %>%
as.data.frame() %>%
## remove the first column "...1" that;s input when the file is imported
dplyr::select(., -...1)
# import ncpms of all male tissues
ncpms_male <- read_delim(file = import_meanM_ncpms,
col_names = TRUE,
delim = ",") %>%
as.data.frame() %>%
## remove the first column "...1" that;s input when the file is imported
dplyr::select(., -...1)
# transform ncpm table so that 'ensembl' are rownames and sex_tissue are columns with ncpms
ncpms_male_2 <- t(ncpms_male) %>%
data.frame() %>%
tibble::rownames_to_column("ensembl")
# tidy table
## remove placenta counts
ncpms_male_2 <- ncpms_male_2[,-3]
## rename column names
colnames(ncpms_male_2) <- gsub("X1", "Female Placenta (mid-gestation)", colnames(ncpms_male_2))
## remove sex_tissue row
ncpms_male_2 <- ncpms_male_2[-1,]
# subset placentaF_depleted to only include ncpms_TMM for placenta and corresponding ensembl IDs
depleted_placentaM <- dplyr::select(placentaM_depleted, ensembl, nCPM_male_placenta_TMM)
# left join ncpms_male_2 to depleted_placentaF
heat_plot <- dplyr::left_join(depleted_placentaM, ncpms_male_2, by = join_by(ensembl))
# tidy
## replace placenta colname
colnames(heat_plot) <- gsub("nCPM_male_placenta_TMM", "Male Placenta (mid-gestation)", colnames(heat_plot))
heat_plot
## put ncpms in descending order
heat_plot_ordered <- heat_plot[order(heat_plot$`Male Placenta (mid-gestation)`, decreasing = TRUE),]
heat_plot_ordered
## make heat_plot_ordered numeric
heat_plot_ordered$`Female Placenta (mid-gestation)` <- as.numeric(heat_plot_ordered$`Female Placenta (mid-gestation)`)
## change order so that placenta is last
heat_plot_ordered <- dplyr::relocate(heat_plot_ordered, `Male Placenta (mid-gestation)`, .after = `Female Placenta (mid-gestation)`)
rownames(heat_plot_ordered) <- NULL
pheat_plot <- tibble::column_to_rownames(heat_plot_ordered, var = "ensembl")
# complex heatmap
library(ComplexHeatmap)
# Heatmap function to visualise the matrix as a heatmap with default settings
## make my df a matrix
class(pheat_plot)
mat <- as.matrix(pheat_plot)
## column splot
column_split_vector <- c(rep("Group 1", 1), "Group 2")
## craete box plot annotation
column_ha <- HeatmapAnnotation(`log10 (nCPMs)` = anno_boxplot(log10(mat), which = c("column"), height = unit(4, "cm")))
## print heatmap with annotation
heatmapM <- Heatmap(log10(mat),
column_split = column_split_vector,
column_title = "Tissues",
column_title_gp = gpar(fontsize = 12),
column_title_side = c("bottom"),
row_title = "Genes",
row_title_gp = gpar(fontsize = 12),
show_row_names = FALSE,
column_names_rot = 45,
column_names_gp = gpar(fontsize = 10),
cluster_rows = FALSE,
cluster_columns = FALSE,
width = unit(2, "cm"),
name = "log10 (nCPM)",
border = "black",
bottom_annotation = column_ha)
heatmapM
# export heatmap as jpeg
path_save <- "/Users/taylaalbertini/Desktop/R studio/honours_project/sexSpecific_comparison/analysis/heatmaps/male_depleted_heatmap.jpeg"
jpeg(path_save, width = 4000, height = 3500, res = 400)
draw(heatmapM)
dev.off()
# Chunk 1
# load relevant libraries
library(plyr)
library(reshape2)
library(dplyr)
library(stringr)
library(readxl)
library(readr)
library(magrittr)
library(ggplot2)
library(edgeR)
library(limma)
library(Glimma)
library(RColorBrewer)
# set project directory
projectDir <- "/Users/taylaalbertini/Desktop/R studio/honours_project/sexSpecific_comparison/rawData"
# set path for data tables
import_depletedF <- file.path(projectDir, "depleted_F.csv")
import_meanF_ncpms <- file.path(projectDir, "mean_placenta_cpms_TMM.csv")
# Chunk 2
# import female placenta depleted transcript table
placentaF_depleted <- read_delim(file = import_depletedF,
col_names = TRUE,
delim = ",") %>%
as.data.frame() %>%
## remove the first column "...1" that;s input when the file is imported
dplyr::select(., -...1)
# import ncpms of all female tissues
ncpms_female <- read_delim(file = import_meanF_ncpms,
col_names = TRUE,
delim = ",") %>%
as.data.frame() %>%
## remove the first column "...1" that;s input when the file is imported
dplyr::select(., -...1)
# transform ncpm table so that 'ensembl' are rownames and sex_tissue are columns with ncpms
ncpms_female_2 <- t(ncpms_female) %>%
data.frame() %>%
tibble::rownames_to_column("ensembl")
# tidy table
## remove placenta counts
ncpms_female_2 <- ncpms_female_2[,-2]
## rename column names
colnames(ncpms_female_2) <- gsub("X2", "Male Placenta (mid-gestation)", colnames(ncpms_female_2))
## remove sex_tissue row
ncpms_female_2 <- ncpms_female_2[-1,]
# subset placentaF_depleted to only include ncpms_TMM for placenta and corresponding ensembl IDs
depleted_placentaF <- dplyr::select(placentaF_depleted, ensembl, nCPM_female_placenta_TMM)
# left join ncpms_female_2 to depleted_placentaF
heat_plot <- dplyr::left_join(depleted_placentaF, ncpms_female_2, by = join_by(ensembl))
# tidy
## replace placenta colname
colnames(heat_plot) <- gsub("nCPM_female_placenta_TMM", "Female Placenta (mid-gestation)", colnames(heat_plot))
## put ncpms in descending order
heat_plot_ordered <- heat_plot[order(heat_plot$`Female Placenta (mid-gestation)`, decreasing = TRUE),]
## make heat_plot_ordered numeric
heat_plot_ordered$`Male Placenta (mid-gestation)` <- as.numeric(heat_plot_ordered$`Male Placenta (mid-gestation)`)
## change order so that placenta is last
heat_plot_ordered <- dplyr::relocate(heat_plot_ordered, `Female Placenta (mid-gestation)`, .after = `Male Placenta (mid-gestation)`)
rownames(heat_plot_ordered) <- NULL
pheat_plot <- tibble::column_to_rownames(heat_plot_ordered, var = "ensembl")
# complex heatmap
library(ComplexHeatmap)
# Heatmap function to visualise the matrix as a heatmap with default settings
## make my df a matrix
class(pheat_plot)
mat <- as.matrix(pheat_plot)
## column splot
column_split_vector <- c(rep("Group 1", 1), "Group 2")
## craete box plot annotation
column_ha <- HeatmapAnnotation(`log10 (nCPMs)` = anno_boxplot(log10((mat)+ 0.001), which = c("column"), height = unit(4, "cm")))
## print heatmap with annotation
heatmapF <- Heatmap(log10((mat) + 0.001),
column_split = column_split_vector,
column_title = "Tissues",
column_title_gp = gpar(fontsize = 12),
column_title_side = c("bottom"),
row_title = "Genes",
row_title_gp = gpar(fontsize = 12),
show_row_names = FALSE,
column_names_rot = 45,
column_names_gp = gpar(fontsize = 10),
cluster_rows = FALSE,
cluster_columns = FALSE,
width = unit(2, "cm"),
name = "log10 (nCPM)",
border = "black",
bottom_annotation = column_ha)
heatmapF
# export heatmap as jpeg
path_save <- "/Users/taylaalbertini/Desktop/R studio/honours_project/sexSpecific_comparison/analysis/heatmaps/female_depleted_heatmap.jpeg"
jpeg(path_save, width = 4000, height = 3500, res = 400)
draw(heatmapF)
dev.off()
library(stringr)
library(magrittr)
library(ggplot2)
library(RColorBrewer)
library(ggkegg)
library(tidygraph)
library(scatterpie)
library(dplyr)
library(readxl)
library(readr)
library(edgeR)
library(limma)
library(Glimma)
library(clusterProfiler)
library(enrichplot)
library(gprofiler2)
library(forcats)
library(rrvgo)
library(ComplexHeatmap)
# set project directory
projectDir <- "/Users/taylaalbertini/Desktop/R studio/honours_project/term_sex_specific_analysis/rawData"
import_placentaF_depleted <- file.path(projectDir, "termF_placenta_depleted_annotated.csv")
import_placnetaM_depleted <- file.path(projectDir, "termM_placenta_depleted_annotated.csv")
reducedTerms_termM <- read_delim("/Users/taylaalbertini/Desktop/R studio/honours_project/fetal_comparison/enrichmentAnalysis_fetal.Rproj/raw_data/reducedTerms_termM_sexSpecific.csv",
col_names = TRUE,
delim = ",") %>%
dplyr::select(., -...1)
View(reducedTerms_termM)
# import male placenta depleted table and make into a data frame
placentaM_depleted <- read_delim(import_placnetaM_depleted,
col_names = TRUE,
delim = ",") %>%
as.data.frame() %>%
## tidy placentaM_depleted - remove the "...1" column
dplyr::select(., -...1)
# male placenta enrichment analysis
# order genes by nCPM_ratio
placentaM_ordered <- placentaM_depleted[order(placentaM_depleted$nCPM_ratio_TMM, decreasing = TRUE),]
# perform enrichment on ordered genes
placentaM_ordered_enriched <- gost(placentaM_ordered$ensembl, organism = "hsapiens",
ordered_query = TRUE)
simMatrixM_BP <- calculateSimMatrix(placentaM_ordered_enriched$result$term_id,
orgdb = "org.Hs.eg.db",
ont = "BP",
method = "Rel")
## set scores
scoresM <- setNames(-log10(placentaM_ordered_enriched$result$p_value), placentaM_ordered_enriched$result$term_id)
## reduce the number of terms based on the similarity matrix for BP terms
reducedTermsM_BP <- reduceSimMatrix(simMatrixM_BP,
threshold = 0.85,
orgdb = "org.Hs.eg.db",
scoresM)
View(reducedTerms_termM)
View(reducedTermsM_BP)
# perform enrichment on ordered genes
placentaM_ordered_enriched <- gost(placentaM_ordered$ensembl, organism = "hsapiens",
ordered_query = TRUE,
evcodes = TRUE)
enriched_row <- placentaM_ordered_enriched$result[placentaM_ordered_enriched$result$term_name == go_term_of_interest, ]
print(enriched_row$intersection)
# investigate which genes were enriched in GO terms
go_term_of_interest <- "regulation of hormone levels"
enriched_row <- placentaM_ordered_enriched$result[placentaM_ordered_enriched$result$term_name == go_term_of_interest, ]
print(enriched_row$intersection)
# investigate which genes were enriched in GO terms
go_term_of_interest <- "positive regulation of vasoconstriction"
enriched_row <- placentaM_ordered_enriched$result[placentaM_ordered_enriched$result$term_name == go_term_of_interest, ]
print(enriched_row$intersection)
# investigate which genes were enriched in GO terms
go_term_of_interest <- "positive regulation of secretion"
enriched_row <- placentaM_ordered_enriched$result[placentaM_ordered_enriched$result$term_name == go_term_of_interest, ]
print(enriched_row$intersection)
# investigate which genes were enriched in GO terms
go_term_of_interest <- "positive regulation of peptide hormone secretion"
enriched_row <- placentaM_ordered_enriched$result[placentaM_ordered_enriched$result$term_name == go_term_of_interest, ]
print(enriched_row$intersection)
# investigate which genes were enriched in GO terms
go_term_of_interest <- "positive regulation of peptide secretion"
enriched_row <- placentaM_ordered_enriched$result[placentaM_ordered_enriched$result$term_name == go_term_of_interest, ]
print(enriched_row$intersection)
# investigate which genes were enriched in GO terms
go_term_of_interest <- "positive regulation of heterotypic cell-cell adhesion"
enriched_row <- placentaM_ordered_enriched$result[placentaM_ordered_enriched$result$term_name == go_term_of_interest, ]
print(enriched_row$intersection)
# investigate which genes were enriched in GO terms
go_term_of_interest <- "positive regulation of hormone secretion"
enriched_row <- placentaM_ordered_enriched$result[placentaM_ordered_enriched$result$term_name == go_term_of_interest, ]
print(enriched_row$intersection)
# investigate which genes were enriched in GO terms
go_term_of_interest <- "positive regulation of protein secretion"
enriched_row <- placentaM_ordered_enriched$result[placentaM_ordered_enriched$result$term_name == go_term_of_interest, ]
print(enriched_row$intersection)
# investigate which genes were enriched in GO terms
go_term_of_interest <- "extracellular region"
enriched_row <- placentaM_ordered_enriched$result[placentaM_ordered_enriched$result$term_name == go_term_of_interest, ]
print(enriched_row$intersection)
library(stringr)
library(magrittr)
library(ggplot2)
library(RColorBrewer)
library(ggkegg)
library(tidygraph)
library(scatterpie)
library(dplyr)
library(readxl)
library(readr)
library(edgeR)
library(limma)
library(Glimma)
library(clusterProfiler)
library(enrichplot)
library(gprofiler2)
library(forcats)
library(rrvgo)
library(ComplexHeatmap)
# set project directory
projectDir <- "/Users/taylaalbertini/Desktop/R studio/honours_project/term_sex_specific_analysis/rawData"
import_placentaF_depleted <- file.path(projectDir, "termF_placenta_depleted_annotated.csv")
import_placnetaM_depleted <- file.path(projectDir, "termM_placenta_depleted_annotated.csv")
# import placenta female depleted table and make it into a data frame
placentaF_depleted <- read_delim(import_placentaF_depleted,
col_names = TRUE,
delim = ",") %>%
as.data.frame() %>%
## tidy placentaF_depleted - remove the "...1" column
dplyr::select(., -...1)
# female placenta enrichment analysis
## order genes by nCPM_ratio
placentaF_ordered <- placentaF_depleted[order(placentaF_depleted$nCPM_ratio_TMM, decreasing = TRUE),]
# perform enrichment analysis on ordered genes
placentaF_ordered_enriched <- gost(placentaF_ordered$ensembl, organism = "hsapiens",
ordered_query = TRUE,
evcodes = TRUE)
write.csv(placentaF_ordered_enriched$result, file = file.path("/Users/taylaalbertini/Desktop/termF_sexspecific.csv"))
placenta_export <- placentaF_ordered_enriched$result
write.csv(placenta_export, file = file.path("/Users/taylaalbertini/Desktop/termF_sexspecific.csv"))
View(placentaF_ordered_enriched)
placenta_export <- dplyr::select(placenta_export, term_name, p_value, source)
write.csv(placenta_export, file = file.path("/Users/taylaalbertini/Desktop/termF_sexspecific.csv"))
