---
title: "mid_enrichmentAnalysis"
output: html_document
date: "2024-05-27"
---

# load libraries
```{r}
library(stringr)
library(magrittr)
library(ggplot2)
library(RColorBrewer)

# set project directory
projectDir <- "/Users/taylaalbertini/Desktop/R studio/honours_project/oxygen_threshold/rawData"
import_placentaF_depleted <- file.path(projectDir, "mid_placentaF_depleted_annotated.csv")
import_placentaM_depleted <- file.path(projectDir, "mid_placentaM_depleted_annotated.csv")
```

# install ggkegg
```{r}
# install ggkegg, scatterpie and tidygraph packages if don't already have 
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("ggkegg")

BiocManager::install("tidygraph")

BiocManager::install("scatterpie")

# load libraries
library(ggkegg)
library(tidygraph)
library(scatterpie)
library(dplyr)
library(readxl)
library(readr)
library(edgeR)
library(limma)
library(Glimma)
library(clusterProfiler)
library(enrichplot)
```

# import files
```{r}
# import placenta female depleted table and make it into a data frame
placentaF_depleted <- read_delim(import_placentaF_depleted,
                                 col_names = TRUE,
                                 delim = ",") %>%
  as.data.frame() 
  ## tidy placentaF_depleted - remove the "...1" column
  placentaF_depleted <- dplyr::select(placentaF_depleted, -...1)

# import male placenta depleted table and make into a data frame
placentaM_depleted <- read_delim(import_placentaM_depleted,
                                 col_names = TRUE,
                                 delim = ",") %>%
  as.data.frame()
  ## tidy placentaM_depleted - remove the "...1" column
  placentaM_depleted <- dplyr::select(placentaM_depleted, -...1)
```


# gprofiler2 functional enrichment analysis
```{r}
# install and laod library for gprofiler2
BiocManager::install("gprofiler2")
library(gprofiler2)

# female placenta enrichment analysis
placentaF_enriched <- gost(placentaF_depleted$ensembl, organism = "hsapiens")
head(placentaF_enriched$result)

# order genes by nCPM_ratio
placentaF_ordered <- placentaF_depleted[order(placentaF_depleted$nCPM_ratio_TMM, decreasing = TRUE),]

# perform enrichment analysis on ordered genes
placentaF_ordered_enriched <- gost(placentaF_ordered$ensembl, organism = "hsapiens",
                                   ordered_query = TRUE)

head(placentaF_ordered_enriched$result, 50)

# male placenta enrichment analysis
placentaM_enriched <- gost(placentaM_depleted$ensembl, organism = "hsapiens")
head(placentaM_enriched$result)

# order genes by nCPM_ratio
placentaM_ordered <- placentaM_depleted[order(placentaM_depleted$nCPM_ratio_TMM, decreasing = TRUE),]
# perform enrichment on ordered genes
placentaM_ordered_enriched <- gost(placentaM_ordered$ensembl, organism = "hsapiens",
                                   ordered_query = TRUE)
head(placentaM_ordered_enriched$result, 50)
```

# visualisation of enriched female placenta ensembls
```{r}
# female placenta plot
# visualise the enriched genes in a plot
gostplot(placentaF_ordered_enriched, interactive = TRUE)
# make a 'publishable plot with top 4 enriched genes highlighted
placentaF_enriched_plot <- gostplot(placentaF_ordered_enriched, interactive = FALSE)
publish_gostplot(placentaF_enriched_plot, highlight_terms = c("GO:0007155", "GO:0032501", "GO:0048731", "GO:0007275"))

# male placenta plot
placentaM_enriched_plot <- gostplot(placentaM_ordered_enriched, interactive = FALSE)
publish_gostplot(placentaM_enriched_plot, highlight_terms = c("GO:0032501", "GO:0042592", "GO:0007155", "GO:0010817"))
```
